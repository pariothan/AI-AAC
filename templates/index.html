<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAC Communication Builder</title>
    <style>
        :root {
            --primary: #5465ff;
            --primary-hover: #3f53ec;
            --surface: rgba(255, 255, 255, 0.98);
            --surface-muted: #f2f4ff;
            --surface-strong: #ffffff;
            --border: rgba(84, 101, 255, 0.18);
            --border-strong: rgba(84, 101, 255, 0.32);
            --text-strong: #0f172a;
            --text-muted: #636f88;
            --shadow-lg: 0 28px 60px rgba(15, 23, 42, 0.08);
            --shadow-sm: 0 12px 30px rgba(84, 101, 255, 0.12);
            --radius-lg: 28px;
            --radius-md: 20px;
            --radius-sm: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Arial, sans-serif;
            background: linear-gradient(180deg, #e8efff 0%, #f9fbff 100%);
            color: var(--text-strong);
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: stretch;
            padding: 16px;
            overflow: hidden;
        }

        h1, h2, h3 {
            font-weight: 700;
        }

        button {
            font: inherit;
        }

        .app-shell {
            max-width: 1280px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px;
            display: flex;
            gap: 20px;
            align-items: stretch;
            min-height: 0;
            height: 100%;
            box-shadow: var(--shadow-lg);
        }

        /* Sidebar - Word Bank */
        .sidebar {
            flex: 0 0 320px;
            background: var(--surface-muted);
            display: flex;
            flex-direction: column;
            gap: 14px;
            border-radius: var(--radius-md);
            padding: 18px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transition: flex-basis 0.3s ease;
            height: 100%;
            min-height: 0;
            overflow: hidden;
        }

        .sidebar.focused {
            flex-basis: min(520px, 55%);
        }

        .sidebar-header {
            display: flex;
            flex-direction: column;
            gap: 18px;
            flex-shrink: 0;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-strong);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .focus-btn {
            width: 40px;
            height: 40px;
            background: var(--surface-strong);
            border: 1px solid var(--border-strong);
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .focus-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 25px rgba(84, 101, 255, 0.22);
        }

        .focus-btn.active {
            background: var(--primary);
            color: white;
            border-color: transparent;
        }

        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .search-box {
            padding-top: 10px;
            border-top: 1px dashed rgba(84, 101, 255, 0.16);
            flex-shrink: 0;
        }

        .search-box input[type="text"] {
            margin-top: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface-strong);
            font-size: 15px;
            outline: none;
            transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            color: var(--text-strong);
        }

        input[type="text"]::placeholder {
            color: #9ba5c0;
        }

        input[type="text"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(84, 101, 255, 0.18);
            background: #ffffff;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 18px;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background: var(--primary);
            color: #ffffff;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 18px 32px rgba(84, 101, 255, 0.28);
        }

        .word-bank {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 4px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-height: 0;
        }

        .word-bank::-webkit-scrollbar,
        .sentences-list::-webkit-scrollbar {
            width: 10px;
        }

        .word-bank::-webkit-scrollbar-thumb,
        .sentences-list::-webkit-scrollbar-thumb {
            background: rgba(84, 101, 255, 0.2);
            border-radius: 20px;
        }

        .word-bank::-webkit-scrollbar-track,
        .sentences-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .category {
            background: var(--surface-strong);
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .category:hover {
            border-color: var(--border);
            box-shadow: 0 16px 30px rgba(84, 101, 255, 0.12);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            color: var(--text-strong);
            border-radius: var(--radius-sm);
            cursor: pointer;
            user-select: none;
            font-size: 15px;
            font-weight: 600;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .category-header:hover {
            background: rgba(84, 101, 255, 0.08);
        }

        .category-header.expanded {
            background: rgba(84, 101, 255, 0.12);
            color: var(--primary);
        }

        .category-icon {
            font-size: 18px;
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .category-name {
            flex: 1;
        }

        .category-arrow {
            transition: transform 0.2s ease;
            font-size: 11px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .category-arrow.expanded {
            transform: rotate(90deg);
        }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 0 10px;
        }

        .category-content.expanded {
            max-height: 3000px;
            padding: 10px;
        }

        .bank-term {
            background: var(--surface-muted);
            padding: 9px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 1px solid transparent;
            user-select: none;
            font-size: 15px;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease, background 0.2s ease;
            white-space: nowrap;
            box-shadow: 0 8px 18px rgba(84, 101, 255, 0.12);
        }

        .bank-term:hover {
            background: rgba(84, 101, 255, 0.15);
            border-color: rgba(84, 101, 255, 0.35);
            transform: translateY(-2px);
            box-shadow: 0 16px 30px rgba(84, 101, 255, 0.18);
        }

        .bank-term:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .term-count {
            margin-top: auto;
            padding-top: 16px;
            border-top: 1px dashed rgba(84, 101, 255, 0.2);
            font-size: 13px;
            color: var(--text-muted);
            text-align: center;
            flex-shrink: 0;
        }

        /* Main Canvas Area */
        .canvas-area {
            flex: 1;
            display: flex;
            gap: 18px;
            align-items: stretch;
            min-height: 0;
        }

        .workspace-column {
            flex: 1;
            background: var(--surface-muted);
            border-radius: var(--radius-md);
            padding: 18px 18px 22px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            gap: 18px;
            position: relative;
            min-height: 0;
            overflow: hidden;
        }

        .workspace-heading {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .workspace-heading h2 {
            font-size: 20px;
            letter-spacing: -0.01em;
        }

        .workspace {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-content: flex-start;
            padding: 20px;
            background: var(--surface-strong);
            border-radius: var(--radius-md);
            border: 2px dashed rgba(84, 101, 255, 0.18);
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 4px rgba(84, 101, 255, 0.08);
        }

        .workspace.dragover {
            background: rgba(84, 101, 255, 0.08);
            border-color: rgba(84, 101, 255, 0.38);
            box-shadow: inset 0 0 0 3px rgba(84, 101, 255, 0.18);
        }

        .canvas-term {
            position: relative;
            background: #eef0ff;
            padding: 10px 16px;
            border-radius: 18px;
            box-shadow: 0 12px 20px rgba(84, 101, 255, 0.18);
            cursor: grab;
            user-select: none;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            border: 1px solid rgba(84, 101, 255, 0.35);
            flex-shrink: 0;
            color: #363dcc;
        }

        .canvas-term:hover {
            transform: translateY(-2px);
            background: #dde1ff;
            box-shadow: 0 18px 28px rgba(84, 101, 255, 0.24);
        }

        .canvas-term:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .canvas-term.dragging {
            opacity: 0.55;
        }

        .canvas-term .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #ff5d72;
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            line-height: 1;
            box-shadow: 0 10px 18px rgba(255, 93, 114, 0.3);
        }

        .canvas-term:hover .remove-btn {
            display: flex;
        }

        .insertion-marker {
            width: 3px;
            min-height: 50px;
            background: var(--primary);
            border-radius: 3px;
            flex-shrink: 0;
            opacity: 0.7;
        }

        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-muted);
            font-size: 16px;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .empty-state-icon {
            font-size: 42px;
        }

        /* Sentences Panel */
        .sentences-panel {
            flex: 0 0 320px;
            background: var(--surface-muted);
            display: flex;
            flex-direction: column;
            gap: 16px;
            border-radius: var(--radius-md);
            padding: 18px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transition: flex-basis 0.3s ease;
            height: 100%;
            min-height: 0;
            overflow: hidden;
        }

        .sentences-panel.focused {
            flex-basis: min(520px, 55%);
        }

        .sentences-header-box {
            display: flex;
            flex-direction: column;
            gap: 14px;
            flex-shrink: 0;
        }

        .sentences-header {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-strong);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sentences-list {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 4px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 0;
        }

        .sentence-item {
            padding: 12px 16px;
            background: var(--surface-strong);
            border-radius: var(--radius-sm);
            box-shadow: 0 10px 24px rgba(84, 101, 255, 0.14);
            font-size: 15px;
            line-height: 1.5;
            color: var(--text-strong);
            border: 1px solid rgba(84, 101, 255, 0.22);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
            cursor: pointer;
        }

        .sentence-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 30px rgba(84, 101, 255, 0.22);
            border-color: rgba(84, 101, 255, 0.35);
        }

        .sentences-empty {
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
            padding: 24px 16px;
            background: rgba(84, 101, 255, 0.08);
            border-radius: var(--radius-sm);
            border: 1px dashed rgba(84, 101, 255, 0.25);
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(248, 250, 255, 0.78);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading.show {
            display: flex;
        }

        .loading-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 32px 40px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(84, 101, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 18px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-strong);
            font-size: 16px;
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            body {
                height: auto;
                min-height: 100vh;
                overflow-y: auto;
                padding: 12px;
            }

            .app-shell {
                height: auto;
            }

            .container {
                flex-direction: column;
                height: auto;
                padding: 16px;
            }

            .canvas-area {
                flex-direction: column;
                min-height: auto;
            }

            .sidebar,
            .sidebar.focused,
            .sentences-panel,
            .sentences-panel.focused {
                flex: 1 1 auto;
                width: 100%;
                height: auto;
            }

            .workspace-column {
                order: 2;
                height: auto;
            }

            .sentences-panel {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .container {
                padding: 16px;
            }

            .workspace {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <div class="container">
            <!-- Sidebar Word Bank -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <span>Word Bank</span>
                        <button class="focus-btn" id="focusWordsBtn">â‡„</button>
                    </div>
                    <div class="input-container">
                        <input
                            type="text"
                            id="contextInput"
                            placeholder="Enter context"
                        />
                        <button class="btn btn-primary" id="generateBtn">Generate Words</button>
                    </div>
                </div>

                <div class="search-box">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Search words"
                    />
                </div>

                <div class="word-bank" id="wordBank"></div>

                <div class="term-count">
                    <span id="termCount">0 words in bank</span>
                </div>
            </div>

            <!-- Canvas Area -->
            <div class="canvas-area">
                <div class="workspace-column">
                    <div class="workspace-heading">
                        <h2>Workspace</h2>
                    </div>

                    <div class="workspace" id="workspace">
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸ’¬</div>
                            <div>Workspace empty</div>
                        </div>
                    </div>
                </div>

                <!-- Sentences Panel -->
                <div class="sentences-panel" id="sentencesPanel">
                    <div class="sentences-header-box">
                        <div class="sentences-header">
                            <span>Sentences</span>
                            <button class="focus-btn" id="focusSentencesBtn">â‡„</button>
                        </div>
                        <button class="btn btn-primary" id="generateSentencesBtn">Create Sentences</button>
                    </div>
                    <div class="sentences-list" id="sentencesList">
                        <div class="sentences-empty">No sentences yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="loading-card">
            <div class="spinner"></div>
            <div class="loading-text">Generating words...</div>
        </div>
    </div>

    <script>
        // Main app logic
        let allTerms = [];
        let canvasTerms = [];

        // Category data with emojis and words
        const categories = {
            'ðŸ¤– Context': { emoji: 'ðŸ¤–', name: 'Context', words: [] },
            'ðŸ‘¤ Pronouns': { emoji: 'ðŸ‘¤', name: 'Pronouns', words: ['ðŸ‘¤ I', 'ðŸ‘¥ you', 'ðŸ‘¨ he', 'ðŸ‘© she', 'âš¡ it', 'ðŸ‘« we', 'ðŸ‘¥ they', 'ðŸ™‹ me', 'ðŸ™‹â€â™‚ï¸ him', 'ðŸ™‹â€â™€ï¸ her', 'ðŸ¤ us', 'ðŸ‘¬ them', 'ðŸ“Œ my', 'ðŸ“ your', 'ðŸ”¹ his', 'ðŸ”¸ her', 'â­ its', 'ðŸŒŸ our', 'âœ¨ their', 'ðŸ’Ž mine', 'ðŸŽ yours', 'ðŸ’ hers', 'ðŸ† ours', 'ðŸŽ¯ theirs', 'ðŸ‘‰ this', 'ðŸ‘ˆ that', 'ðŸ”½ these', 'ðŸ”¼ those', 'â“ who', 'â” what', 'ðŸ”€ which', 'ðŸ‘¤ whom', 'ðŸ·ï¸ whose'] },
            'â“ Question Words': { emoji: 'â“', name: 'Question Words', words: ['â“ ?', 'â“ who', 'â” what', 'â° when', 'ðŸ“ where', 'ðŸ¤” why', 'ðŸ› ï¸ how', 'ðŸ”€ which', 'ðŸ·ï¸ whose', 'ðŸ‘¤ whom', 'ðŸ’° how much', 'ðŸ”¢ how many', 'â±ï¸ how long', 'ðŸ“ how far', 'ðŸ” how often'] },
            'ðŸ“ Prepositions': { emoji: 'ðŸ“', name: 'Prepositions', words: ['ðŸ“¥ in', 'ðŸ”› on', 'ðŸ“ at', 'ðŸ‘‰ by', 'ðŸ¤ with', 'â¬…ï¸ from', 'âž¡ï¸ to', 'ðŸ“¦ of', 'ðŸŽ for', 'ðŸ’­ about', 'â¬†ï¸ above', 'â†”ï¸ across', 'â–¶ï¸ after', 'ðŸš« against', 'ðŸ›¤ï¸ along', 'ðŸŽª among', 'ðŸ”„ around', 'â†—ï¸ as', 'âª before', 'â¬‡ï¸ behind', 'ðŸ”½ below', 'â¤µï¸ beneath', 'â†•ï¸ beside', 'â¬Œ between', 'ðŸŒŒ beyond', 'â¬‡ï¸ down', 'â³ during', 'ðŸš· except', 'ðŸ  inside', 'ðŸ“¥ into', 'ðŸ’ like', 'ðŸ“Œ near', 'ðŸ”Œ off', 'ðŸšª out', 'ðŸžï¸ outside', 'ðŸ” over', 'â®ï¸ past', 'ðŸ“… since', 'ðŸ”€ through', 'ðŸŒ throughout', 'â° till', 'ðŸŽ¯ toward', 'â¬‡ï¸ under', 'â³ until', 'â¬†ï¸ up', 'ðŸ”› upon', 'ðŸ“¦ within', 'ðŸš« without'] },
            'ðŸ™ Politeness': { emoji: 'ðŸ™', name: 'Politeness', words: ['ðŸ™ please', 'ðŸ’ thank you', 'ðŸ™Œ thanks', 'ðŸ˜” sorry', 'ðŸ™‹ excuse me', 'ðŸŽ­ pardon', 'ðŸ¤— welcome', 'ðŸ’– appreciate', 'ðŸ™ grateful', 'âœ¨ kindly', 'ðŸ¤² may I', 'â“ would you', 'ðŸ™‹ could you', 'ðŸ¤ if you don\'t mind', 'ðŸ’­ I\'d appreciate', 'ðŸŽ many thanks', 'ðŸ¤ much obliged'] },
            'ðŸ‘‹ Greetings': { emoji: 'ðŸ‘‹', name: 'Greetings', words: ['ðŸ‘‹ hello', 'âœ‹ hi', 'ðŸ™Œ hey', 'ðŸŒ… good morning', 'â˜€ï¸ good afternoon', 'ðŸŒ† good evening', 'ðŸŒ™ good night', 'ðŸ‘‹ goodbye', 'âœŒï¸ bye', 'ðŸ‘€ see you', 'ðŸ’ take care', 'ðŸŒŸ have a good day', 'ðŸ¤ nice to meet you', 'â“ how are you', 'ðŸ”¥ what\'s up', 'ðŸ¤  howdy', 'ðŸŽ­ greetings', 'ðŸ¤— welcome'] },
            'ðŸ“ Spatial/Location': { emoji: 'ðŸ—ºï¸', name: 'Spatial/Location', words: ['ðŸ“ here', 'ðŸ‘‰ there', 'ðŸŒ everywhere', 'â“ somewhere', 'ðŸš« nowhere', 'ðŸ—ºï¸ anywhere', 'â¬†ï¸ up', 'â¬‡ï¸ down', 'â¬…ï¸ left', 'âž¡ï¸ right', 'â–¶ï¸ forward', 'â—€ï¸ backward', 'ðŸ”œ ahead', 'ðŸ”™ behind', 'ðŸ“Œ nearby', 'ðŸŒŒ far', 'ðŸ¤ close', 'â†—ï¸ away', 'ðŸ”„ around', 'ðŸ  inside', 'ðŸŒ³ outside', 'â¬†ï¸ upstairs', 'â¬‡ï¸ downstairs', 'â†”ï¸ next to', 'â†•ï¸ opposite', 'ðŸ”— adjacent'] },
            'â° Time': { emoji: 'â°', name: 'Time', words: ['âš¡ now', 'â° then', 'ðŸ“… today', 'â®ï¸ yesterday', 'â­ï¸ tomorrow', 'ðŸŒ™ tonight', 'ðŸŒ… morning', 'â˜€ï¸ afternoon', 'ðŸŒ† evening', 'ðŸŒƒ night', 'â° later', 'ðŸ”œ soon', 'â° early', 'âŒ› late', 'âª before', 'â© after', 'â³ during', 'âŒš while', 'â™¾ï¸ always', 'ðŸš« never', 'ðŸ”„ sometimes', 'ðŸ“Š often', 'ðŸ¥‰ rarely', 'ðŸ“ˆ usually', 'âœ… already', 'â° yet', 'â¸ï¸ still', 'âš¡ just', 'ðŸ• recently', 'â®ï¸ ago'] },
            'ðŸ‘ï¸ Sensory Verbs': { emoji: 'ðŸ‘ï¸', name: 'Sensory Verbs', words: ['ðŸ‘ï¸ see', 'ðŸ‘€ look', 'ðŸ“º watch', 'ðŸ” observe', 'ðŸ’¡ notice', 'ðŸ‘ï¸ glimpse', 'ðŸ‘ï¸ stare', 'ðŸ‘€ gaze', 'ðŸ‘ï¸ peek', 'ðŸ‘‚ hear', 'ðŸŽ§ listen', 'ðŸ”Š sound', 'ðŸ‘ƒ smell', 'ðŸ‘ƒ sniff', 'ðŸ‘… taste', 'ðŸ¤š touch', 'ðŸ’­ feel', 'ðŸ§  sense', 'ðŸŽ¯ perceive', 'âš¡ experience'] },
            'ðŸ§  Mental/Action Verbs': { emoji: 'ðŸ§ ', name: 'Mental/Action Verbs', words: ['ðŸ§  know', 'ðŸ’­ think', 'âœ¨ believe', 'ðŸ’¡ understand', 'ðŸ§  remember', 'ðŸŒ«ï¸ forget', 'ðŸ“š learn', 'ðŸ’¡ realize', 'ðŸ” recognize', 'ðŸŒˆ imagine', 'ðŸ¤” wonder', 'ðŸ’­ suppose', 'ðŸ“Š assume', 'ðŸŽ¯ expect', 'ðŸŒŸ hope', 'âœ¨ wish', 'ðŸ’ want', 'ðŸ“ need', 'â¤ï¸ like', 'ðŸ’– love', 'ðŸ’” hate', 'â­ prefer', 'ðŸ˜Š enjoy', 'ðŸ¤” mind', 'ðŸ’ care', 'ðŸ˜° worry', 'ðŸ˜¨ fear', 'ðŸ¤¨ doubt', 'ðŸ¤ trust', 'ðŸ’¬ mean', 'ðŸŽ¯ intend', 'ðŸ“‹ plan', 'âœ… decide', 'ðŸŽ¯ choose', 'ðŸ¤” consider', 'ðŸ§© figure', 'ðŸŽ² guess', 'ðŸŽ° bet', 'âš¡ do', 'ðŸ”¨ make', 'ðŸ“¦ get', 'ðŸ¤² take', 'ðŸŽ give', 'ðŸ“Œ put', 'ðŸ”§ use', 'ðŸ” find', 'ðŸ‘‰ show', 'ðŸ¤ help', 'âœ… let', 'ðŸ“¦ keep', 'ðŸ‘‹ leave', 'â–¶ï¸ start', 'ðŸŽ¬ begin', 'â¹ï¸ stop', 'ðŸ end', 'âœ… finish', 'â–¶ï¸ continue', 'ðŸ’ª try', 'ðŸŽ¯ attempt', 'âœ… manage', 'âŒ fail', 'ðŸ† succeed', 'ðŸ’¼ work', 'ðŸŽ® play', 'ðŸ˜´ rest', 'â° wait', 'ðŸ“ stay', 'ðŸ”’ remain', 'ðŸ”„ become', 'ðŸ”€ change', 'ðŸŒ± grow', 'ðŸ“ˆ develop', 'â¬†ï¸ improve', 'ðŸ“ˆ increase', 'ðŸ“‰ decrease', 'âž• add', 'âž– remove', 'âœ… include', 'ðŸš« exclude', 'ðŸ“¦ contain', 'ðŸ§© consist', 'ðŸ·ï¸ belong', 'ðŸ‘‘ own', 'ðŸ¤ have', 'ðŸ’Ž possess', 'ðŸš« lack', 'ðŸ˜¢ miss', 'ðŸ“‰ lose', 'ðŸ† win', 'ðŸ“ˆ gain', 'ðŸ’° earn', 'ðŸ›’ buy', 'ðŸ’µ sell', 'ðŸ’¸ spend', 'ðŸ’° save', 'ðŸ—‘ï¸ waste', 'ðŸ¤ share', 'âž— divide', 'ðŸ”— join', 'âœ‚ï¸ separate', 'ðŸ”— connect', 'ðŸ“Ž attach', 'ðŸ”“ detach'] },
            'ðŸš¶ Physical/Communication Verbs': { emoji: 'ðŸš¶', name: 'Physical/Communication Verbs', words: ['ðŸš¶ go', 'ðŸ‘‹ come', 'ðŸƒ move', 'ðŸš¶ walk', 'ðŸƒ run', 'ðŸ¦˜ jump', 'ðŸ§— climb', 'â¬‡ï¸ fall', 'ðŸª‘ sit', 'ðŸ§ stand', 'ðŸ›ï¸ lie', 'ðŸ˜´ sleep', 'â° wake', 'â¬†ï¸ rise', 'ðŸ”„ turn', 'ðŸ‘‰ push', 'ðŸ¤² pull', 'â¬†ï¸ lift', 'ðŸ“¦ carry', 'ðŸ¤² hold', 'âœŠ grab', 'ðŸ¤¾ catch', 'ðŸŽ¯ throw', 'ðŸ‘Š hit', 'ðŸ¦µ kick', 'ðŸ¤š touch', 'ðŸ¤² reach', 'ðŸ‘‰ point', 'ðŸ‘‹ wave', 'ðŸ¤ shake', 'ðŸ™‚ nod', 'ðŸšª open', 'ðŸ”’ close', 'ðŸ” lock', 'ðŸ”“ unlock', 'ðŸ’¥ break', 'ðŸ”§ fix', 'ðŸ—ï¸ build', 'ðŸ”¨ make', 'âœ¨ create', 'âœ‚ï¸ cut', 'ðŸ“„ tear', 'ðŸª¢ bend', 'ðŸ“‹ fold', 'ðŸ¤¸ stretch', 'ðŸ¤ squeeze', 'ðŸ‘† press', 'ðŸ–ï¸ rub', 'ðŸ–ï¸ scratch', 'ðŸ§¹ wipe', 'âœ¨ clean', 'ðŸš¿ wash', 'ðŸ’¨ dry', 'ðŸ‘• wear', 'ðŸ‘” dress', 'âž– remove', 'ðŸª hang', 'â¬‡ï¸ drop', 'ðŸ’¬ say', 'ðŸ—£ï¸ tell', 'ðŸ—¨ï¸ speak', 'ðŸ’¬ talk', 'â“ ask', 'ðŸ’¡ answer', 'â†©ï¸ reply', 'ðŸ’¬ respond', 'ðŸ“– explain', 'ðŸ“ describe', 'ðŸ’­ mention', 'ðŸ“¢ state', 'ðŸ“£ declare', 'ðŸ“¢ announce', 'ðŸ“° report', 'â„¹ï¸ inform', 'ðŸ”” notify', 'âš ï¸ warn', 'ðŸ’¡ advise', 'ðŸ’­ suggest', 'ðŸŒŸ recommend', 'ðŸ“‹ propose', 'ðŸŽ offer', 'ðŸ™ request', 'ðŸ“¢ demand', 'ðŸ“œ order', 'ðŸ‘‘ command', 'ðŸ™ beg', 'ðŸ˜¢ plead', 'ðŸ’¢ argue', 'ðŸ’¬ discuss', 'âš–ï¸ debate', 'âœ… agree', 'âŒ disagree', 'ðŸš« deny', 'âœ… admit', 'ðŸ˜” confess', 'ðŸ¤ promise', 'âœ‹ swear', 'ðŸ“¢ claim', 'ðŸ’ª insist', 'ðŸ˜¤ complain', 'ðŸ‘Ž criticize', 'ðŸ‘ praise', 'ðŸ™ thank', 'ðŸ˜” apologize', 'ðŸ‘‹ greet', 'ðŸ¤ introduce', 'ðŸ“ž call', 'ðŸ·ï¸ name', 'ðŸ¤« whisper', 'ðŸ“¢ shout', 'ðŸ˜± yell', 'ðŸ˜± scream', 'ðŸ˜¢ cry', 'ðŸ˜‚ laugh', 'ðŸ˜Š smile', 'ðŸ½ï¸ eat', 'ðŸ¥¤ drink'] },
            'ðŸ”¢ Quantity': { emoji: 'ðŸ”¢', name: 'Quantity', words: ['ðŸ’¯ all', 'ðŸ“Š some', 'ðŸ“ˆ many', 'ðŸ¤ few', 'ðŸ“Š several', 'ðŸ’¯ much', 'ðŸ¤ little', 'âž• more', 'âž– less', 'ðŸ† most', 'ðŸ¥‰ least', 'âœ… enough', 'ðŸ“¦ plenty', 'ðŸ“¦ lots', 'ðŸš« none', 'â“ any', '1ï¸âƒ£ each', 'ðŸ’¯ every', '2ï¸âƒ£ both', 'ðŸ”€ either', 'ðŸš« neither', 'Â½ half', 'ðŸ’¯ whole', 'ðŸ§© part', 'ðŸ§© piece'] },
            'âœ¨ Quality/Description': { emoji: 'âœ¨', name: 'Quality/Description', words: ['ðŸ‘ good', 'ðŸ‘Ž bad', 'ðŸ“ big', 'ðŸ¤ small', 'ðŸ“ large', 'ðŸ¤ little', 'ðŸ“ long', 'ðŸ“ short', 'ðŸ—¼ tall', 'â¬†ï¸ high', 'â¬‡ï¸ low', 'â†”ï¸ wide', 'ðŸšª narrow', 'ðŸ“š thick', 'ðŸ“„ thin', 'âš–ï¸ heavy', 'ðŸª¶ light', 'ðŸª¨ hard', 'ðŸ§¸ soft', 'ðŸ”¥ hot', 'â„ï¸ cold', 'â˜€ï¸ warm', 'ðŸ§Š cool', 'âœ¨ new', 'ðŸ“œ old', 'ðŸ‘¶ young', 'âš¡ fast', 'ðŸŒ slow', 'âœ… easy', 'ðŸ˜° difficult', 'ðŸª¨ hard', 'ðŸ˜Š simple', 'ðŸ§© complex', 'âœ¨ clean', 'ðŸ—‘ï¸ dirty', 'ðŸ˜ beautiful', 'ðŸ‘¹ ugly', 'ðŸ˜Š nice', 'ðŸ’– pretty', 'ðŸ’ª strong', 'ðŸ˜” weak', 'ðŸ’¡ bright', 'ðŸŒ‘ dark', 'ðŸ“¢ loud', 'ðŸ¤« quiet', 'ðŸ“¦ full', 'ðŸ“­ empty', 'âœ… right', 'âŒ wrong', 'âœ… true', 'âŒ false', 'ðŸ’Ž real', 'ðŸŽ­ fake', 'âœ… safe', 'âš ï¸ dangerous'] },
            'ðŸ”— Connectors': { emoji: 'ðŸ”—', name: 'Connectors', words: ['âž• and', 'ðŸ”€ or', 'â— but', 'â†—ï¸ so', 'ðŸ’¡ because', 'â“ if', 'âž¡ï¸ then', 'ðŸ”€ although', 'ðŸ”€ though', 'â†”ï¸ however', 'âž¡ï¸ therefore', 'âž¡ï¸ thus', 'âž¡ï¸ hence', 'âž• moreover', 'âž• furthermore', 'âž• besides', 'âž• also', 'âž• too', 'ðŸ”€ either', 'ðŸš« neither', 'â— yet', 'â¸ï¸ still', 'ðŸ”€ instead', 'ðŸ”€ otherwise', 'â¸ï¸ meanwhile', 'â° while', 'â†”ï¸ whereas', 'ðŸš« unless', 'â° until', 'ðŸ“… since'] },
            'âœ… Agreement/Disagreement': { emoji: 'âœ…', name: 'Agreement/Disagreement', words: ['âœ… yes', 'âŒ no', 'ðŸ‘Œ okay', 'ðŸ‘Œ ok', 'ðŸ‘ sure', 'ðŸ‘Œ alright', 'ðŸ˜Š fine', 'ðŸ¤ agreed', 'ðŸ’¯ exactly', 'ðŸ’¯ absolutely', 'ðŸ’¯ definitely', 'âœ… certainly', 'ðŸ’¯ of course', 'âœ… indeed', 'âœ… right', 'âœ… correct', 'âœ… true', 'ðŸ¤” maybe', 'ðŸ¤· perhaps', 'â“ possibly', 'ðŸ“Š probably', 'âœ… I agree', 'âŒ I disagree', 'ðŸ¤” I think so', 'ðŸ¤· I don\'t think so'] },
            'ðŸ“¦ Common Nouns': { emoji: 'ðŸ“¦', name: 'Common Nouns', words: ['ðŸ‘¤ person', 'ðŸ‘¥ people', 'ðŸ‘¨ man', 'ðŸ‘© woman', 'ðŸ‘¶ child', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ family', 'ðŸ¤ friend', 'ðŸ“¦ thing', 'ðŸ“ place', 'â° time', 'ðŸ“… day', 'ðŸ“† year', 'ðŸ›¤ï¸ way', 'ðŸ’¼ work', 'ðŸ  home', 'ðŸ¡ house', 'ðŸšª room', 'ðŸšª door', 'ðŸªŸ window', 'ðŸª‘ table', 'ðŸª‘ chair', 'ðŸ›ï¸ bed', 'ðŸ½ï¸ food', 'ðŸ’§ water', 'ðŸ’° money', 'ðŸ“š book', 'ðŸ“± phone', 'ðŸš— car', 'ðŸ™ï¸ city', 'ðŸŒ country', 'ðŸŒŽ world', 'ðŸ’« life', 'âœ‹ hand', 'ðŸ‘ï¸ eye', 'ðŸ˜Š face', 'ðŸ§  head', 'ðŸ«€ body', 'ðŸ§© part', 'â†”ï¸ side', 'â¬…ï¸ back', 'â¬†ï¸ top', 'â¬‡ï¸ bottom', 'ðŸ end', 'ðŸ“ point', 'ðŸ’¬ word', 'ðŸ·ï¸ name', 'ðŸ”¢ number', 'â“ question', 'âš ï¸ problem', 'ðŸ’¡ idea', 'ðŸ“– story'] }
        };

        const contextInput = document.getElementById('contextInput');
        const generateBtn = document.getElementById('generateBtn');
        const wordBank = document.getElementById('wordBank');
        const workspace = document.getElementById('workspace');
        const loading = document.getElementById('loading');
        const searchInput = document.getElementById('searchInput');
        const termCount = document.getElementById('termCount');

        // Initialize with default categories
        displayWordBank();

        generateBtn.addEventListener('click', generateTerms);
        contextInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') generateTerms();
        });

        async function generateTerms() {
            const context = contextInput.value.trim();
            if (!context) {
                alert('Please enter a context');
                return;
            }

            loading.classList.add('show');
            generateBtn.disabled = true;

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ context })
                });

                const data = await response.json();

                if (data.success) {
                    // Put generated terms in the Context category
                    categories['ðŸ¤– Context'].words = data.terms;
                    allTerms = getAllTerms();
                    displayWordBank();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error generating terms: ' + error.message);
            } finally {
                loading.classList.remove('show');
                generateBtn.disabled = false;
            }
        }

        function getAllTerms() {
            let terms = [];
            for (let categoryKey in categories) {
                terms = terms.concat(categories[categoryKey].words);
            }
            return terms;
        }

        function displayWordBank(searchQuery = '') {
            wordBank.innerHTML = '';

            for (let categoryKey in categories) {
                const categoryData = categories[categoryKey];
                const categoryTerms = categoryData.words;

                // Filter by search if applicable
                let filteredTerms = categoryTerms;
                if (searchQuery) {
                    filteredTerms = categoryTerms.filter(term =>
                        term.toLowerCase().includes(searchQuery.toLowerCase())
                    );
                }

                // Skip empty categories when searching
                if (searchQuery && filteredTerms.length === 0) continue;

                // Create category
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                // Category header
                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `
                    <span class="category-icon">${categoryData.emoji}</span>
                    <span class="category-name">${categoryData.name} (${filteredTerms.length})</span>
                    <span class="category-arrow">â–¶</span>
                `;

                // Category content
                const content = document.createElement('div');
                content.className = 'category-content';

                // Add terms
                filteredTerms.forEach(term => {
                    const card = document.createElement('div');
                    card.className = 'bank-term';
                    card.textContent = term;
                    card.draggable = true;

                    card.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', term);
                        e.dataTransfer.effectAllowed = 'copy';
                    });

                    card.addEventListener('click', () => {
                        addToCanvas(term);
                    });

                    content.appendChild(card);
                });

                // Toggle expand/collapse
                header.addEventListener('click', () => {
                    const arrow = header.querySelector('.category-arrow');
                    const isExpanded = content.classList.contains('expanded');

                    if (isExpanded) {
                        content.classList.remove('expanded');
                        arrow.classList.remove('expanded');
                        header.classList.remove('expanded');
                    } else {
                        content.classList.add('expanded');
                        arrow.classList.add('expanded');
                        header.classList.add('expanded');
                    }
                });

                categoryDiv.appendChild(header);
                categoryDiv.appendChild(content);
                wordBank.appendChild(categoryDiv);
            }

            updateTermCount();
        }

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value;
            displayWordBank(query);
        });

        // Canvas drag and drop
        let draggedCard = null;
        let insertionMarker = null;

        workspace.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = draggedCard ? 'move' : 'copy';
            workspace.classList.add('dragover');

            const afterElement = getDragAfterElement(workspace, e.clientX, e.clientY);

            // Remove existing marker
            if (insertionMarker && !draggedCard) {
                insertionMarker.remove();
                insertionMarker = null;
            }

            if (draggedCard) {
                // Reordering existing card
                if (afterElement == null) {
                    workspace.appendChild(draggedCard);
                } else {
                    workspace.insertBefore(draggedCard, afterElement);
                }
            } else {
                // Show insertion marker for new items
                if (!insertionMarker) {
                    insertionMarker = document.createElement('div');
                    insertionMarker.className = 'insertion-marker';
                }

                if (afterElement == null) {
                    workspace.appendChild(insertionMarker);
                } else {
                    workspace.insertBefore(insertionMarker, afterElement);
                }
            }
        });

        workspace.addEventListener('dragleave', (e) => {
            if (e.target === workspace) {
                workspace.classList.remove('dragover');
                if (insertionMarker) {
                    insertionMarker.remove();
                    insertionMarker = null;
                }
            }
        });

        workspace.addEventListener('drop', (e) => {
            e.preventDefault();
            workspace.classList.remove('dragover');

            // Clean up insertion marker
            if (insertionMarker) {
                insertionMarker.remove();
                insertionMarker = null;
            }

            const term = e.dataTransfer.getData('text/plain');
            if (term && !draggedCard) {
                // Adding from sidebar
                const afterElement = getDragAfterElement(workspace, e.clientX, e.clientY);
                addToCanvas(term, afterElement);
            }

            draggedCard = null;
        });

        function getDragAfterElement(container, x, y) {
            const draggableElements = [...container.querySelectorAll('.canvas-term:not(.dragging)')];

            let closestElement = null;
            let closestDistance = Infinity;

            draggableElements.forEach(child => {
                const box = child.getBoundingClientRect();
                const centerX = box.left + box.width / 2;
                const centerY = box.top + box.height / 2;

                const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));

                // If cursor is to the left of the element's center, insert before it
                if (x < centerX && distance < closestDistance) {
                    closestDistance = distance;
                    closestElement = child;
                }
            });

            return closestElement;
        }

        function addToCanvas(term, beforeElement) {
            const card = document.createElement('div');
            card.className = 'canvas-term';
            card.textContent = term;
            card.draggable = true;

            // Remove button
            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'Ã—';
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                card.remove();
                canvasTerms = canvasTerms.filter(t => t.element !== card);

                // Show empty state if no more terms
                const emptyState = workspace.querySelector('.empty-state');
                if (emptyState && canvasTerms.length === 0) {
                    emptyState.style.display = 'block';
                }
            });
            card.appendChild(removeBtn);

            // Drag events for reordering
            card.addEventListener('dragstart', (e) => {
                draggedCard = card;
                card.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            });

            card.addEventListener('dragend', () => {
                card.classList.remove('dragging');
                draggedCard = null;
            });

            // Insert at position or append
            if (beforeElement) {
                workspace.insertBefore(card, beforeElement);
            } else {
                workspace.appendChild(card);
            }

            canvasTerms.push({ term, element: card });

            // Hide empty state
            const emptyState = workspace.querySelector('.empty-state');
            if (emptyState && canvasTerms.length > 0) {
                emptyState.style.display = 'none';
            }
        }

        function updateTermCount() {
            const total = getAllTerms().length;
            termCount.textContent = `${total} words in bank`;
        }

        // Sentence generation
        const generateSentencesBtn = document.getElementById('generateSentencesBtn');
        const sentencesList = document.getElementById('sentencesList');

        generateSentencesBtn.addEventListener('click', async () => {
            // Get words from workspace in order
            const wordsInWorkspace = Array.from(workspace.querySelectorAll('.canvas-term'))
                .map(el => el.textContent.replace('Ã—', '').trim());

            if (wordsInWorkspace.length === 0) {
                alert('Add some words to the workspace first!');
                return;
            }

            generateSentencesBtn.disabled = true;
            generateSentencesBtn.textContent = 'Generating...';
            sentencesList.innerHTML = '<div class="sentences-empty">Generating sentences...</div>';

            try {
                const response = await fetch('/generate-sentences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ words: wordsInWorkspace })
                });

                const data = await response.json();

                if (data.success && data.sentences) {
                    sentencesList.innerHTML = '';
                    data.sentences.forEach(sentence => {
                        const sentenceItem = document.createElement('div');
                        sentenceItem.className = 'sentence-item';
                        sentenceItem.textContent = sentence;
                        sentencesList.appendChild(sentenceItem);
                    });
                } else {
                    sentencesList.innerHTML = '<div class="sentences-empty">Error generating sentences. Please try again.</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                sentencesList.innerHTML = '<div class="sentences-empty">Error generating sentences. Please try again.</div>';
            } finally {
                generateSentencesBtn.disabled = false;
                generateSentencesBtn.textContent = 'Create Sentences';
            }
        });

        // Focus functionality
        const sidebar = document.getElementById('sidebar');
        const sentencesPanel = document.getElementById('sentencesPanel');
        const focusWordsBtn = document.getElementById('focusWordsBtn');
        const focusSentencesBtn = document.getElementById('focusSentencesBtn');

        focusWordsBtn.addEventListener('click', () => {
            const isFocused = sidebar.classList.contains('focused');

            if (isFocused) {
                sidebar.classList.remove('focused');
                focusWordsBtn.classList.remove('active');
                focusWordsBtn.textContent = 'â‡„';
            } else {
                sidebar.classList.add('focused');
                sentencesPanel.classList.remove('focused');
                focusWordsBtn.classList.add('active');
                focusSentencesBtn.classList.remove('active');
                focusWordsBtn.textContent = 'â‡†';
                focusSentencesBtn.textContent = 'â‡„';
            }
        });

        focusSentencesBtn.addEventListener('click', () => {
            const isFocused = sentencesPanel.classList.contains('focused');

            if (isFocused) {
                sentencesPanel.classList.remove('focused');
                focusSentencesBtn.classList.remove('active');
                focusSentencesBtn.textContent = 'â‡„';
            } else {
                sentencesPanel.classList.add('focused');
                sidebar.classList.remove('focused');
                focusSentencesBtn.classList.add('active');
                focusWordsBtn.classList.remove('active');
                focusSentencesBtn.textContent = 'â‡†';
                focusWordsBtn.textContent = 'â‡„';
            }
        });
    </script>
</body>
</html>
